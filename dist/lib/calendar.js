!function(t,e){"function"==typeof define&&define.amd?define("calendar",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(t.jQuery)}(this,function(p){var t={width:280,height:280,zIndex:1,trigger:null,offset:[0,1],customClass:"",view:"date",date:new Date,format:"yyyy/mm/dd",startWeek:0,weekArray:["日","一","二","三","四","五","六"],selectedRang:null,data:null,label:"{d}\n{v}",prev:"&lt;",next:"&gt;",viewChange:p.noop,onSelected:function(t,e,a){},onMouseenter:p.noop,onClose:p.noop},e="data-calendar-",a="["+e+"display-date]",i="["+e+"display-month]",o=e+"day",n=e+"month",l="markData",s={date:"calendar-d",month:"calendar-m"},d="now",h="selected",r='style="width:{w}px;height:{h}px;line-height:{h}px"',c="<li "+r+">{wk}</li>",u="<li "+r+' class="{class}" {action}>{value}</li>',m="<li "+r+" "+n+">{m}月</li>",g=['<div class="calendar-inner">','<div class="calendar-views">','<div class="view view-date">','<div class="calendar-hd">','<a href="javascript:;" data-calendar-display-date class="calendar-display">','{yyyy}/<span class="m">{mm}</span>',"</a>",'<div class="calendar-arrow">','<span class="prev" title="上一月" data-calendar-arrow-date>{prev}</span>','<span class="next" title="下一月" data-calendar-arrow-date>{next}</span>',"</div>","</div>",'<div class="calendar-ct">','<ol class="week">{week}</ol>','<ul class="date-items"></ul>',"</div>","</div>",'<div class="view view-month">','<div class="calendar-hd">','<a href="javascript:;" data-calendar-display-month class="calendar-display">{yyyy}</a>','<div class="calendar-arrow">','<span class="prev" title="上一年" data-calendar-arrow-month>{prev}</span>','<span class="next" title="下一年" data-calendar-arrow-month>{next}</span>',"</div>","</div>",'<ol class="calendar-ct month-items">{month}</ol>',"</div>","</div>","</div>",'<div class="calendar-label"><p>HelloWorld</p><i></i></div>'],f=Object.prototype.toString;function v(t){return"[object Date]"===f.call(t)}function D(t){return t.getAttribute("class")||t.getAttribute("className")}function w(t,e){this.$element=p(t),this.options=p.extend({},p.fn.calendar.defaults,e),this.$element.addClass("calendar "+this.options.customClass),this.width=this.options.width,this.height=this.options.height,this.date=this.options.date,this.selectedRang=this.options.selectedRang,this.data=this.options.data,this.init()}String.prototype.repeat=function(a){return this.replace(/\{\w+\}/g,function(t){var e=t.replace(/\{|\}/g,"");return a[e]||""})},String.prototype.toDate=function(){var t=new Date,e=this.replace(/\d/g,"").charAt(0),a=this.split(e);return t.setFullYear(a[0]),t.setMonth(a[1]-1),t.setDate(a[2]),t},Date.prototype.format=function(t){var e=this.getFullYear(),a=this.getMonth()+1,i=this.getDate();return t.replace("yyyy",e).replace("mm",a).replace("dd",i)},Date.prototype.isSame=function(t,e,a){if(v(t)){var i=t;t=i.getFullYear(),e=i.getMonth()+1,a=i.getDate()}return this.getFullYear()===t&&this.getMonth()+1===e&&this.getDate()===a},Date.prototype.add=function(t){this.setDate(this.getDate()+t)},Date.prototype.minus=function(t){this.setDate(this.getDate()-t)},Date.prototype.clearTime=function(t){return this.setHours(0),this.setSeconds(0),this.setMinutes(0),this.setMilliseconds(0),this},Date.isLeap=function(t){return t%100!=0&&t%4==0||t%400==0},Date.getDaysNum=function(t,e){var a=31;switch(e){case 2:a=this.isLeap(t)?29:28;break;case 4:case 6:case 9:case 11:a=30}return a},Date.getSiblingsMonth=function(t,e,a){var i=new Date(t,e-1);return i.setMonth(e-1+a),{y:i.getFullYear(),m:i.getMonth()+1}},Date.getPrevMonth=function(t,e,a){return this.getSiblingsMonth(t,e,0-(a||1))},Date.getNextMonth=function(t,e,a){return this.getSiblingsMonth(t,e,a||1)},Date.tryParse=function(t){return t?v(t)?t:t.toDate():t},w.prototype={constructor:w,getDayAction:function(t){var e=o;if(this.selectedRang){var a=Date.tryParse(this.selectedRang[0]),i=Date.tryParse(this.selectedRang[1]);(a&&t<a.clearTime()||i&&t>i.clearTime())&&(e="disabled")}return e},getDayData:function(t){var e,a=this.data;if(a)for(var i=0,n=a.length;i<n;i++){var s=a[i];t.isSame(s.date.toDate())&&(e=s.value)}return e},getDayItem:function(t,e,a,i){var n,s,r=this.date,o=new Date(t,e-1,a),h={w:this.width/7,h:this.height/7,value:a};r.isSame(t,e,a);return h.class=1===i?"old":3===i?"new":"",r.isSame(t,e,a)&&(h.class+=" "+d),h.action=this.getDayAction(o),n=this.getDayData(o),s=p(u.repeat(h)),n&&(s.data(l,n),s.html(a+'<i class="dot"></i>')),s},getDaysHtml:function(t,e){this.date;var a,i,n,s,r,o=p('<ol class="days"></ol>');i=v(t)?(a=t.getFullYear(),t.getMonth()+1):(a=Number(t),Number(e)),r=(new Date(a,i-1,1).getDay()||7)-this.options.startWeek,n=Date.getDaysNum(a,i),s=Date.getPrevMonth(a,i),prevDaysNum=Date.getDaysNum(a,s.m),nextM=Date.getNextMonth(a,i);for(var h=0,l=prevDaysNum-r+1;l<=prevDaysNum;l++,h++)o.append(this.getDayItem(s.y,s.m,l,1));for(var d=1;d<=n;d++,h++)o.append(this.getDayItem(a,i,d,2));for(var c=1,u=42-h;c<=u;c++)o.append(this.getDayItem(nextM.y,nextM.m,c,3));return p("<li></li>").width(this.options.width).append(o)},getWeekHtml:function(){for(var t=[],e=this.options.weekArray,a=this.options.startWeek,i=e.length,n=this.width/7,s=this.height/7,r=a;r<i;r++)t.push(c.repeat({w:n,h:s,wk:e[r]}));for(var o=0;o<a;o++)t.push(c.repeat({w:n,h:s,wk:e[o]}));return t.join("")},getMonthHtml:function(){for(var t=[],e=this.width/4,a=this.height/4,i=1;i<13;i++)t.push(m.repeat({w:e,h:a,m:i}));return t.join("")},setMonthAction:function(t){var e=this.date.getMonth()+1;this.$monthItems.children().removeClass(d),t===this.date.getFullYear()&&this.$monthItems.children().eq(e-1).addClass(d)},fillStatic:function(){var t={prev:this.options.prev,next:this.options.next,week:this.getWeekHtml(),month:this.getMonthHtml()};this.$element.html(g.join("").repeat(t))},updateDisDate:function(t,e){this.$disDate.html('{year}/<span class="m">{month}</span>'.repeat({year:t,month:e}))},updateDisMonth:function(t){this.$disMonth.html(t)},fillDateItems:function(t,e){var a=[Date.getPrevMonth(t,e),{y:t,m:e},Date.getNextMonth(t,e)];this.$dateItems.html("");for(var i=0;i<3;i++){var n=this.getDaysHtml(a[i].y,a[i].m);this.$dateItems.append(n)}},hide:function(t,e,a){this.$trigger.val(e.format(this.options.format)),this.options.onClose.call(this,t,e,a),this.$element.hide()},trigger:function(){this.$trigger=this.options.trigger instanceof p?this.options.trigger:p(this.options.trigger);var e=this,a=e.$element,t=e.$trigger.offset(),i=e.options.offset;a.addClass("calendar-modal").css({left:t.left+i[0]+"px",top:t.top+e.$trigger.outerHeight()+i[1]+"px",zIndex:e.options.zIndex}),e.$trigger.click(function(){a.show()}),p(document).click(function(t){e.$trigger[0]==t.target||p.contains(a[0],t.target)||a.hide()})},render:function(){this.$week=this.$element.find(".week"),this.$dateItems=this.$element.find(".date-items"),this.$monthItems=this.$element.find(".month-items"),this.$label=this.$element.find(".calendar-label"),this.$disDate=this.$element.find(a),this.$disMonth=this.$element.find(i);var t=this.date.getFullYear(),e=this.date.getMonth()+1;this.updateDisDate(t,e),this.updateMonthView(t),this.fillDateItems(t,e),this.options.trigger&&this.trigger()},setView:function(t){this.$element.removeClass(s.date+" "+s.month).addClass(s[t]),this.view=t},updateDateView:function(i,n,t,s){n=n||this.date.getMonth()+1;var r=this,o=this.$dateItems;return t?{prev:function(){var t=Date.getPrevMonth(i,n),e=Date.getPrevMonth(i,n,2),a=r.getDaysHtml(e.y,e.m);n=t.m,i=t.y,o.animate({marginLeft:0},300,"swing",function(){o.children(":last").remove(),o.prepend(a).css("margin-left","-100%"),p.isFunction(s)&&s.call(r)})},next:function(){var t=Date.getNextMonth(i,n),e=Date.getNextMonth(i,n,2),a=r.getDaysHtml(e.y,e.m);n=t.m,i=t.y,o.animate({marginLeft:"-200%"},300,"swing",function(){o.children(":first").remove(),o.append(a).css("margin-left","-100%"),p.isFunction(s)&&s.call(r)})}}[t]():this.fillDateItems(i,n),this.updateDisDate(i,n),this.setView("date"),{y:i,m:n}},updateMonthView:function(t){this.updateDisMonth(t),this.setMonthAction(t),this.setView("month")},getDisDateValue:function(){var t=this.$disDate.html().split("/");return[Number(t[0]),Number(t[1].match(/\d{1,2}/)[0])]},selectedDay:function(e,t){function a(){this.$dateItems.children(":eq(1)").find("["+o+"]:not(.new, .old)").removeClass(h).filter(function(t){return parseInt(this.innerHTML)===e}).addClass(h)}var i=this.getDisDateValue(),n=i[0],s=i[1];if(t){var r=this.updateDateView(n,s,{old:"prev",new:"next"}[t],a);n=r.y,s=r.m,this.options.viewChange("date",n,s)}else a.call(this);return new Date(n,s-1,e)},showLabel:function(t,e,a,i){var n=this.$label;n.find("p").html(this.options.label.repeat({m:e,d:a.format(this.options.format),v:i}).replace(/\n/g,"<br>"));var s=n.outerWidth(),r=n.outerHeight();n.css({left:t.pageX-s/2+"px",top:t.pageY-r-20+"px"}).show()},hasLabel:function(){return!!this.options.label&&(p("body").append(this.$label),!0)},event:function(){var s=this,r=s.options.viewChange;s.$element.on("click",a,function(){var t=s.getDisDateValue();s.updateMonthView(t[0],t[1]),r("month",t[0],t[1])}).on("click",i,function(){var t=this.innerHTML;s.updateDateView(t),r("date",t)}),s.$element.on("click","[data-calendar-arrow-date]",function(){var t=s.getDisDateValue(),e=D(this),a=t[0],i=t[1],n=s.updateDateView(a,i,e,function(){r("date",n.y,n.m)})}).on("click","[data-calendar-arrow-month]",function(){var t=Number(s.$disMonth.html());t="prev"===D(this)?t-1:t+1,s.updateMonthView(t),r("month",t)}),s.$element.on("click","["+o+"]",function(){var t=parseInt(this.innerHTML),e=D(this),a=/new|old/.test(e)?e.match(/new|old/)[0]:"",i=s.selectedDay(t,a);s.options.onSelected.call(this,"date",i,p(this).data(l)),s.$trigger&&s.hide("date",i,p(this).data(l))}).on("click","["+n+"]",function(){var t=Number(s.$disMonth.html()),e=parseInt(this.innerHTML);s.updateDateView(t,e),r("date",t,e),s.options.onSelected.call(this,"month",new Date(t,e-1))}),s.$element.on("mouseenter","["+o+"]",function(t){var e=s.getDisDateValue(),a=new Date(e[0],e[1]-1,parseInt(this.innerHTML));s.hasLabel&&p(this).data(l)&&(p("body").append(s.$label),s.showLabel(t,"date",a,p(this).data(l))),s.options.onMouseenter.call(this,"date",a,p(this).data(l))}).on("mouseleave","["+o+"]",function(){s.$label.hide()})},resize:function(){var t=this.width,e=this.height,a=this.$element.find(".calendar-hd").outerHeight();this.$element.width(t).height(e+a).find(".calendar-inner, .view").css("width",t+"px"),this.$element.find(".calendar-ct").width(t).height(e)},init:function(){this.fillStatic(),this.resize(),this.render(),this.view=this.options.view,this.setView(this.view),this.event()},setData:function(t){if(this.data=t,"date"===this.view){var e=this.getDisDateValue();this.fillDateItems(e[0],e[1])}else"month"===this.view&&this.updateMonthView(this.$disMonth.html())},methods:function(t,e){if("[object Function]"===f.call(this[t]))return this[t].apply(this,e)}},p.fn.calendar=function(t){var e,a=this.data("calendar"),i=[].slice.call(arguments);return a?function(t){return"[object String]"===f.call(t)}(t)?(e=t,i.shift(),a.methods(e,i)):this:this.each(function(){return p(this).data("calendar",new w(this,t))})},p.fn.calendar.defaults=t});